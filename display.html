
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>抽奖展示</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: 'Segoe UI', 'PingFang SC', sans-serif;
      overflow: hidden;
    }
    .main {
      text-align: center;
      padding-top: 6vh;
    }
    h1 {
      font-size: 3.5em;
      text-shadow: 0 0 20px gold;
      color: gold;
    }
    .info {
      margin-top: 4vh;
      font-size: 2.2em;
      text-shadow: 0 0 8px white;
    }
    .prize-img {
      margin-top: 40px;
      height: 180px;
    }
    .meta {
      margin-top: 16px;
      font-size: 1.4em;
      color: #f5f5f5;
      text-shadow: 0 0 10px #999;
    }
  </style>
</head>
<body>
  <div class="main">
    <h1 id="prize">🎁 当前奖品</h1>
    <div class="info" id="winner">等待抽奖...</div>
    <img id="prizeImg" class="prize-img" />
    <div class="meta" id="prizeMeta"></div>
  </div>

  <script>
    const flags = {
      "中国": "🇨🇳", "印度": "🇮🇳", "泰国": "🇹🇭", "马来西亚": "🇲🇾",
      "孟加拉国": "🇧🇩", "巴基斯坦": "🇵🇰", "印度尼西亚": "🇮🇩", "阿联酋": "🇦🇪",
      "俄罗斯": "🇷🇺", "老挝": "🇱🇦", "坦桑尼亚": "🇹🇿", "阿尔及利亚": "🇩🇿",
      "几内亚": "🇬🇳", "古巴": "🇨🇺", "巴西": "🇧🇷", "苏丹": "🇸🇩",
      "哈萨克斯坦": "🇰🇿", "乌兹别克斯坦": "🇺🇿", "希腊": "🇬🇷", "越南": "🇻🇳",
      "美国": "🇺🇸", "英国": "🇬🇧", "日本": "🇯🇵", "德国": "🇩🇪", "法国": "🇫🇷"
    };

    function matchFlag(nation) {
      const lower = nation.toLowerCase();
      for (const key in flags) {
        if (lower.includes(key.toLowerCase())) {
          return flags[key] + " " + nation;
        }
      }
      return nation;
    }

    const channel = new BroadcastChannel("draw-channel");
    channel.onmessage = (e) => {
      const data = e.data;
      document.getElementById("prize").textContent = `🎁 ${data.prize || '当前奖品'}`;
      const parts = (data.text || "").split("｜");
      if (parts.length >= 3) {
        const flagNation = matchFlag(parts[2]);
        document.getElementById("winner").textContent = `🎯 ${parts[0]}｜${parts[1]}｜${flagNation}`;
      } else {
        document.getElementById("winner").textContent = data.text || "";
      }

      const img = document.getElementById("prizeImg");
      img.src = data.img || "";
      img.style.display = data.img ? "block" : "none";

      document.getElementById("prizeMeta").textContent =
        `💰 ${data.price || ''}   🎁 数量：${data.qty || ''}`;
    };
  </script>
</body>
</html>
